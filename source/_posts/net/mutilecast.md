---
title: 组播
type: net
description: Linux组播相关知识点总结
date: 2020-06-22 19:10:42
---
组播技术的初衷是在IP网络中，以"尽力而为"的形式发送信息到某个目标组，这个目标组称为组播组，这样在有源主机向多点目标主机发送信息需求时，源主机只发送一份数据，数据的目的地址是组播组地址，这样，凡是属于该组的成员，都可以接收到一份原主机发送的数据的拷贝，此组播方式下，只有真正信息需要的成员会收到信息，其他主机不会收到。

## 什么是组播？

_**组播的概念?**_

首先我们知道单播报文，是一个host发送给另一个host，在报文的IP层有明确的源、目IP地址。一个host发送，另一个
host接收。

那组播是什么呢？顾明思议，就是一个host发出的报文可以被多个加入某个相同组的host接收，是一对多的关系。

_**组播报文的目的IP是什么？**_

对于单播报文，报文中有明确的目的MAC和目的IP，那组播报文的目的MAC和目的IP是什么？又是如何做到发送给一组主机的呢？

在 [IP地址知识点总结](#) 一文中我们知道，**D类IP地址**（224.0.0.0 ~ 239.255.255.255）是IPV4的多播地址。其中D类地址的
低28bit（D类IPV的前4bit固定为1110）构成多播组ID，整个32位地址则称为组地址。也就是说，我们发送的多播报文的目的IP地址应该包含在D类IP
地址中（这样我们就知道组播报文的IP层目的IP了）。

_**组播报文的目的MAC是什么？**_

IEEE规定，以太网MAC地址 首个字节的最低位值为1时，代表组播或者广播报文。对于组播报文，以太网地址的高序24bit总是 **01:00:5e**。下一位总是0，
然后低序23bit复制自多播组ID的低序23bit。 （前面提到，组播地址的组ID由低28bit组成，那现在以太网组播地址，只使用组ID的低23位）这样问题来了，
组地址的中组ID的前5bit被忽略了，那么也就是说存在 2的5次方个组地址，映射成一个相同的以太网组播MAC地址（这个地方要特别注意，并非一一映射的关系）。

IPV4组地址到以太网MAC地址映射关系，如下图：

![IPV4映射以太网MAC](/images/ipv4_map_mac.png)

_**组播IP如何分配？**_

目前全球性的组播IP地址分配机构尚未出现，也就是说你的应用程序可以任意指定组播IP（除了224.0.0.0~224.0.0.255之间的地址，这个地址段称为链路局部
多播地址，是保留地址）。 那如果我们任意指定了组播IP，会不会冲突呢？ 答案是肯定的，也就是说例如你的应用程序都加入了224.11.2.7这个多播组，那么
如果有未知的应用也同样加入了该组，不好意思，你们之间将会互相收到对方发送的数据。 

_**如何解决冲突？**_

**源特定多播** 就是为了解决组播IP冲突的，概念上：1. 接收进程向多播路由器提供发送进程的源地址作为加入多播组操作的一部分。2. 把多播组标识从单纯的
多播组IP细化为了单播源地址和多播目的地址的组合。

_**互联网上任意两个位置的主机只要加入同一个多播组，是不是就可以直接相互通信了？**_

不一定。 组播通信时需要网络支持的。

- **传统组播** : 需要通信双方的所有网络结节都支持 **IGMP**。 因为在主机加入多播组的时候，是依靠 **IGMP** 协议实现组播组通告的。
- **源特定多播** : 通信双方除了需要 **IGMP** 的支持，还需要其它一些**SSM**相关协议支持。  目前应用并不广泛。

## Linux组播编程

我们编写这样一个程序，要求如下：

* 该程序加入一个或者多个组播组，通过传入参数决定。如果没有指定参数，则加入一个默认的组播组
* 该程序既能作为组播客户端、又能作为组播服务器端。通过运行时指定参数决定
* 客户端从标准输入读取数据，然后发送给服务器端 
* 服务器端收到客户端发送过来的数据后打印到标准输出


